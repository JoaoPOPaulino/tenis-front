<div class="container">
  <h2>{{ formGroup.value.id ? 'Editar Usuário' : 'Novo Usuário' }}</h2>
  
  <form [formGroup]="formGroup" (ngSubmit)="salvar()">
    <!-- Informações Básicas -->
    <div class="section">
      <h3>Informações Básicas</h3>
      <mat-form-field>
        <mat-label>Nome</mat-label>
        <input matInput formControlName="nome" required>
        <mat-error *ngIf="formGroup.get('nome')?.invalid">Nome é obrigatório</mat-error>
      </mat-form-field>

      <mat-form-field>
        <mat-label>E-mail</mat-label>
        <input matInput formControlName="email" required type="email">
        <mat-error *ngIf="formGroup.get('email')?.hasError('required')">E-mail é obrigatório</mat-error>
        <mat-error *ngIf="formGroup.get('email')?.hasError('email')">E-mail inválido</mat-error>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Login</mat-label>
        <input matInput formControlName="login" required>
        <mat-error *ngIf="formGroup.get('login')?.invalid">Login é obrigatório</mat-error>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Username</mat-label>
        <input matInput formControlName="username" required>
        <mat-error *ngIf="formGroup.get('username')?.invalid">Username é obrigatório</mat-error>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Senha</mat-label>
        <input matInput formControlName="senha" type="password" required>
        <mat-error *ngIf="formGroup.get('senha')?.invalid">Senha é obrigatória</mat-error>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Tipo de Usuário</mat-label>
        <mat-select formControlName="tipoUsuario" required>
          <mat-option *ngFor="let tipo of tiposUsuario" [value]="tipo">
            {{tipo}}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Telefones -->
    <div class="section">
      <h3>Telefones</h3>
      <div formArrayName="telefones">
        <div *ngFor="let telefone of telefonesArray.controls; let i=index" [formGroupName]="i" class="array-item">
          <mat-form-field>
            <mat-label>DDD</mat-label>
            <input matInput formControlName="ddd" required>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Número</mat-label>
            <input matInput formControlName="numero" required>
          </mat-form-field>

          <button mat-icon-button color="warn" type="button" (click)="removeTelefone(i)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
      <button mat-raised-button type="button" (click)="addTelefone()">
        <mat-icon>add</mat-icon> Adicionar Telefone
      </button>
    </div>

    <!-- Endereços -->
    <div class="section">
      <h3>Endereços</h3>
      <div formArrayName="enderecos">
        <div *ngFor="let endereco of enderecosArray.controls; let i=index" [formGroupName]="i" class="array-item">
          <div formGroupName="cidade">
            <mat-form-field>
              <mat-label>Cidade</mat-label>
              <input matInput formControlName="nome" required>
            </mat-form-field>

            <div formGroupName="estado">
              <mat-form-field>
                <mat-label>Estado</mat-label>
                <input matInput formControlName="nome" required>
              </mat-form-field>

              <mat-form-field>
                <mat-label>Sigla</mat-label>
                <input matInput formControlName="sigla" required>
              </mat-form-field>
            </div>
          </div>

          <mat-form-field>
            <mat-label>CEP</mat-label>
            <input matInput formControlName="cep" required>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Quadra</mat-label>
            <input matInput formControlName="quadra" required>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Rua</mat-label>
            <input matInput formControlName="rua" required>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Número</mat-label>
            <input matInput formControlName="numero" required>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Complemento</mat-label>
            <input matInput formControlName="complemento">
          </mat-form-field>

          <mat-checkbox formControlName="principal">Principal</mat-checkbox>
          <mat-checkbox formControlName="ativo">Ativo</mat-checkbox>

          <button mat-icon-button color="warn" type="button" (click)="removeEndereco(i)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
      <button mat-raised-button type="button" (click)="addEndereco()">
        <mat-icon>add</mat-icon> Adicionar Endereço
      </button>
    </div>

    <!-- Cartões -->
    <div class="section">
      <h3>Cartões</h3>
      <div formArrayName="cartoes">
        <div *ngFor="let cartao of cartoesArray.controls; let i=index" [formGroupName]="i" class="array-item">
          <mat-form-field>
            <mat-label>Tipo do Cartão</mat-label>
            <mat-select formControlName="tipoCartao" required>
              <mat-option *ngFor="let tipo of tiposCartao" [value]="tipo">
                {{tipo}}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Número</mat-label>
            <input matInput formControlName="numero" required>
          </mat-form-field>

          <mat-form-field>
            <mat-label>CVV</mat-label>
            <input matInput formControlName="cvv" required>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Validade</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="validade" required>
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Titular</mat-label>
            <input matInput formControlName="titular" required>
          </mat-form-field>

          <mat-form-field>
            <mat-label>CPF</mat-label>
            <input matInput formControlName="cpf" required>
          </mat-form-field>

          <mat-checkbox formControlName="ativo">Ativo</mat-checkbox>

          <button mat-icon-button color="warn" type="button" (click)="removeCartao(i)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
      <button mat-raised-button type="button" (click)="addCartao()">
        <mat-icon>add</mat-icon> Adicionar Cartão
      </button>
    </div>

    <div class="button-group">
      <button mat-raised-button color="primary" type="submit" [disabled]="!formGroup.valid">
        Salvar
      </button>
      <button mat-raised-button color="warn" type="button" (click)="excluir()" *ngIf="formGroup.value.id">
        Excluir
      </button>
      <button mat-raised-button routerLink="/usuarios">
        Voltar
      </button>
    </div>
  </form>
</div>